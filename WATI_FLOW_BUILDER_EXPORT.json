{
  "flowName": "GrandMaster Maritime Bot",
  "description": "Comprehensive maritime WhatsApp bot with conversation, technical, and onboarding flows",
  "version": "1.0",
  "flows": [
    {
      "id": "main_entry",
      "name": "Message Reception & Classification",
      "trigger": "message_received",
      "steps": [
        {
          "id": "step_1",
          "type": "condition",
          "name": "Message Reception Check",
          "condition": {
            "field": "message_text",
            "operator": "is_not_empty"
          },
          "actions": {
            "true": "step_2",
            "false": "recovery_flow"
          }
        },
        {
          "id": "step_2",
          "type": "condition",
          "name": "User Authentication Check",
          "condition": {
            "field": "contact_exists",
            "operator": "equals",
            "value": "true"
          },
          "actions": {
            "true": "step_3",
            "false": "onboarding_flow"
          }
        },
        {
          "id": "step_3",
          "type": "condition_group",
          "name": "Message Classification",
          "conditions": [
            {
              "id": "greeting_check",
              "condition": {
                "field": "message_text",
                "operator": "contains_any",
                "values": ["hi", "hello", "namaste", "hey", "good morning"]
              },
              "action": "greeting_flow"
            },
            {
              "id": "question_check",
              "condition": {
                "field": "message_text",
                "operator": "ends_with",
                "value": "?"
              },
              "additional_condition": {
                "field": "message_length",
                "operator": "greater_than",
                "value": 10
              },
              "action": "technical_flow"
            },
            {
              "id": "command_check",
              "condition": {
                "field": "message_text",
                "operator": "contains_any",
                "values": ["/help", "/profile", "/status", "help"]
              },
              "action": "command_flow"
            },
            {
              "id": "location_check",
              "condition": {
                "field": "message_text",
                "operator": "contains_any",
                "values": ["koi hai", "who is here", "nearby", "location"]
              },
              "action": "location_flow"
            },
            {
              "id": "commercial_check",
              "condition": {
                "field": "message_text",
                "operator": "contains_any",
                "values": ["buy", "price", "store", "order", "purchase"]
              },
              "action": "commercial_flow"
            },
            {
              "id": "emergency_check",
              "condition": {
                "field": "message_text",
                "operator": "contains_any",
                "values": ["emergency", "urgent", "help", "accident", "medical"]
              },
              "action": "emergency_flow"
            }
          ],
          "default_action": "unclear_flow"
        }
      ]
    },
    {
      "id": "greeting_flow",
      "name": "Greeting Response",
      "steps": [
        {
          "id": "greeting_response",
          "type": "send_message",
          "message": {
            "text": "Hello {{contact_name}}! üëã\n\nI'm QBOT, your maritime technical assistant. How can I help you today?\n\n‚Ä¢ Ask any marine engineering question ending with \"?\"\n‚Ä¢ Type \"help\" for available commands\n‚Ä¢ Say \"koi hai\" to find nearby maritime professionals"
          },
          "next": "end_conversation"
        }
      ]
    },
    {
      "id": "technical_flow",
      "name": "Technical Question Processing",
      "steps": [
        {
          "id": "daily_limit_check",
          "type": "condition",
          "name": "Check Daily Question Limit",
          "condition": {
            "field": "daily_questions_count",
            "operator": "less_than",
            "value": "{{profile_complete ? 10 : 3}}"
          },
          "actions": {
            "true": "ambiguity_check",
            "false": "limit_exceeded"
          }
        },
        {
          "id": "limit_exceeded",
          "type": "send_message",
          "message": {
            "text": "{{profile_complete ? \"You've reached your daily limit of 10 technical questions. Your limit will reset at midnight. For urgent queries, contact our experts directly.\" : \"You've reached your daily limit of 3 bot answers. Please update your profile on qaaq.app to ask more questions.\"}}"
          },
          "next": "end_wait"
        },
        {
          "id": "ambiguity_check",
          "type": "condition",
          "name": "Check Question Ambiguity",
          "condition": {
            "field": "message_text",
            "operator": "contains_any",
            "values": ["what is", "purpose of", "how does", "function of"]
          },
          "additional_condition": {
            "field": "message_text",
            "operator": "not_contains_any",
            "values": ["not working", "broken", "failed", "problem", "fix"]
          },
          "actions": {
            "true": "clarification_request",
            "false": "direct_answer"
          }
        },
        {
          "id": "clarification_request",
          "type": "send_message",
          "message": {
            "text": "I want to give you the most helpful answer about {{extract_topic}}. Please clarify:\n\nüîç **Are you asking about:**\nA) **Definition/Theory** - How it works, purpose, technical explanation\nB) **Troubleshooting** - Solving a problem or operational issue\n\nReply **A** for theory/explanation or **B** for problem-solving guidance.\n\nYour question: '{{message_text}}'"
          },
          "next": "wait_clarification"
        },
        {
          "id": "wait_clarification",
          "type": "wait_for_response",
          "timeout": 600,
          "timeout_action": "default_answer",
          "response_handlers": [
            {
              "condition": {
                "field": "message_text",
                "operator": "contains_any",
                "values": ["A", "definition", "theory", "explanation"]
              },
              "action": "definition_answer"
            },
            {
              "condition": {
                "field": "message_text",
                "operator": "contains_any",
                "values": ["B", "troubleshooting", "problem", "fix"]
              },
              "action": "troubleshooting_answer"
            }
          ]
        },
        {
          "id": "definition_answer",
          "type": "ai_response",
          "ai_config": {
            "model": "o1-mini",
            "prompt": "You are a Marine Chief Engineer with 20+ years experience providing educational explanations.\n\nCRITICAL INSTRUCTION: The user is asking for a DEFINITION or EXPLANATION, NOT troubleshooting help.\n\nRESPONSE REQUIREMENTS:\n- Provide clear, educational explanations and definitions\n- Explain PURPOSE and FUNCTION, not problems or solutions\n- Include technical specifications when relevant\n- Use proper maritime engineering terminology\n- Explain HOW it works and WHY it's important\n- NO troubleshooting advice unless specifically asked\n- Be comprehensive but educational in tone (150-200 words)\n\nUser question: {{original_question}}"
          },
          "next": "increment_counter"
        },
        {
          "id": "troubleshooting_answer",
          "type": "ai_response",
          "ai_config": {
            "model": "o1-mini",
            "prompt": "You are a Marine Chief Engineer with 20+ years experience providing troubleshooting guidance.\n\nCRITICAL RESPONSE REQUIREMENTS:\n- Provide comprehensive troubleshooting and problem-solving advice\n- Include detailed diagnostic steps with proper reasoning\n- Be practical and technically accurate\n- NO links, URLs, or 'visit our website' messages\n- Include specific technical details (pressures, temperatures, procedures)\n- Use proper maritime engineering terminology\n- Structure answers with clear diagnostic steps\n- Consider safety implications and best practices\n- Provide context and explain WHY, not just WHAT\n\nUser question: {{original_question}}"
          },
          "next": "increment_counter"
        },
        {
          "id": "direct_answer",
          "type": "condition",
          "name": "Detect Question Type",
          "condition": {
            "field": "message_text",
            "operator": "contains_any",
            "values": ["not working", "broken", "failed", "problem", "fix", "repair"]
          },
          "actions": {
            "true": "troubleshooting_answer",
            "false": "definition_answer"
          }
        },
        {
          "id": "increment_counter",
          "type": "action",
          "action": "increment_daily_questions",
          "next": "end_technical_success"
        }
      ]
    },
    {
      "id": "onboarding_flow",
      "name": "New User Onboarding",
      "steps": [
        {
          "id": "welcome_message",
          "type": "send_message",
          "message": {
            "text": "üö¢ Welcome to QAAQ - Maritime Professional Network!\nI'm QBOT, your 24/7 maritime technical assistant.\n\nPlease share your full name for professional verification:\nExample: \"John Smith\" or \"‡§∞‡§æ‡§ú ‡§ï‡•Å‡§Æ‡§æ‡§∞\""
          },
          "next": "wait_name"
        },
        {
          "id": "wait_name",
          "type": "wait_for_response",
          "timeout": 300,
          "timeout_action": "name_reminder",
          "response_handlers": [
            {
              "condition": {
                "field": "message_text",
                "operator": "is_valid_name"
              },
              "action": "collect_rank"
            }
          ],
          "invalid_response": "name_correction"
        },
        {
          "id": "name_correction",
          "type": "send_message",
          "message": {
            "text": "Please provide your full name (First and Last name):\n‚ùå Avoid: \"CE\", \"2E\", \"Captain\"\n‚úÖ Example: \"Rajesh Kumar\" or \"ŸÖÿ≠ŸÖÿØ ÿπŸÑŸä\""
          },
          "next": "wait_name"
        },
        {
          "id": "collect_rank",
          "type": "send_message",
          "message": {
            "text": "What's your current maritime rank/position?\n\n‚öì **DECK OFFICERS:**\n- Master/Captain\n- Chief Officer\n- Second Officer\n- Third Officer\n- Deck Cadet\n\nüîß **ENGINE OFFICERS:**\n- Chief Engineer\n- Second Engineer\n- Third Engineer\n- Fourth Engineer\n- Engine Cadet\n\nüè¢ **SHORE-BASED:**\n- Marine Superintendent\n- Ship Manager\n- Other Professional"
          },
          "next": "wait_rank"
        },
        {
          "id": "wait_rank",
          "type": "wait_for_response",
          "timeout": 300,
          "response_handlers": [
            {
              "condition": {
                "field": "message_text",
                "operator": "contains_any",
                "values": ["master", "captain", "chief officer", "second officer", "third officer", "deck cadet", "chief engineer", "second engineer", "third engineer", "fourth engineer", "engine cadet", "marine superintendent", "ship manager"]
              },
              "action": "collect_company"
            }
          ],
          "default_action": "rank_clarification"
        },
        {
          "id": "collect_company",
          "type": "send_message",
          "message": {
            "text": "Which ship/company are you currently with?\nExample: \"MV Ocean Pioneer\" or \"Maersk Line\""
          },
          "next": "wait_company"
        },
        {
          "id": "wait_company",
          "type": "wait_for_response",
          "timeout": 180,
          "response_handlers": [
            {
              "condition": "any_response",
              "action": "onboarding_complete"
            }
          ],
          "timeout_action": "onboarding_complete"
        },
        {
          "id": "onboarding_complete",
          "type": "send_message",
          "message": {
            "text": "üéâ Welcome aboard, {{contact_name}}!\n\nYour QAAQ profile is ready. You can now:\n‚úÖ Ask technical maritime questions\n‚úÖ Connect with professionals worldwide\n‚úÖ Access 24/7 expert assistance\n\nSend any marine engineering question ending with \"?\" to get started!"
          },
          "next": "end_onboarding_success"
        }
      ]
    },
    {
      "id": "command_flow",
      "name": "Command Handler",
      "steps": [
        {
          "id": "help_command",
          "type": "condition",
          "name": "Check Help Command",
          "condition": {
            "field": "message_text",
            "operator": "contains",
            "value": "help"
          },
          "actions": {
            "true": "send_help",
            "false": "other_commands"
          }
        },
        {
          "id": "send_help",
          "type": "send_message",
          "message": {
            "text": "üö¢ QBOT Commands:\n\nüìã **Available Commands:**\n‚Ä¢ Ask questions ending with \"?\" for technical help\n‚Ä¢ \"koi hai\" - Find nearby maritime professionals\n‚Ä¢ \"profile\" - View your profile status\n‚Ä¢ \"status\" - Check your daily question limits\n\nüí° **Tips:**\n‚Ä¢ End technical questions with \"?\" for detailed answers\n‚Ä¢ Update your profile for more daily questions\n‚Ä¢ Connect with maritime professionals worldwide"
          },
          "next": "end_conversation"
        }
      ]
    },
    {
      "id": "location_flow",
      "name": "Location Services",
      "steps": [
        {
          "id": "location_response",
          "type": "send_message",
          "message": {
            "text": "üåä Nearby Maritime Professionals:\n\nI'm working on connecting you with nearby seafarers. This feature will show:\n‚Ä¢ Officers in nearby ports\n‚Ä¢ Crew members in your area\n‚Ä¢ Maritime professionals nearby\n\nStay tuned for updates! üö¢"
          },
          "next": "end_conversation"
        }
      ]
    },
    {
      "id": "commercial_flow",
      "name": "Commercial Queries",
      "steps": [
        {
          "id": "commercial_response",
          "type": "send_message",
          "message": {
            "text": "üè™ QAAQ Maritime Services:\n\nFor commercial inquiries and services, please:\n‚Ä¢ Visit our website: qaaq.app\n‚Ä¢ Contact our business team directly\n‚Ä¢ Check available maritime solutions\n\nI'm specialized in technical assistance. For purchases and commercial services, please use our main platform."
          },
          "next": "end_conversation"
        }
      ]
    },
    {
      "id": "emergency_flow",
      "name": "Emergency Handler",
      "steps": [
        {
          "id": "emergency_response",
          "type": "send_message",
          "message": {
            "text": "üö® EMERGENCY SUPPORT\n\nI understand this may be urgent. For immediate emergency assistance:\n\nüÜò **Maritime Emergency:**\n‚Ä¢ Contact Coast Guard immediately\n‚Ä¢ Use VHF Channel 16 for distress calls\n‚Ä¢ Alert nearby vessels\n\nüìû **Technical Support:**\n‚Ä¢ Contact QAAQ emergency line: [Emergency Number]\n‚Ä¢ I'll also try to provide immediate guidance\n\nWhat specific emergency are you facing?"
          },
          "next": "wait_emergency_details"
        },
        {
          "id": "wait_emergency_details",
          "type": "wait_for_response",
          "timeout": 300,
          "response_handlers": [
            {
              "condition": "any_response",
              "action": "escalate_emergency"
            }
          ]
        }
      ]
    },
    {
      "id": "unclear_flow",
      "name": "Unclear Message Handler",
      "steps": [
        {
          "id": "unclear_response",
          "type": "send_message",
          "message": {
            "text": "I didn't quite understand that. ü§î\n\nCould you clarify your maritime question or end it with '?' for technical help?\n\nYou can also:\n‚Ä¢ Type \"help\" for available commands\n‚Ä¢ Ask specific marine engineering questions\n‚Ä¢ Say \"koi hai\" to find nearby professionals"
          },
          "next": "end_wait"
        }
      ]
    }
  ],
  "end_states": [
    {
      "id": "end_conversation",
      "type": "success",
      "description": "Normal conversation completion"
    },
    {
      "id": "end_wait",
      "type": "waiting",
      "description": "Waiting for user response",
      "timeout": 86400
    },
    {
      "id": "end_technical_success",
      "type": "success",
      "description": "Technical question answered successfully"
    },
    {
      "id": "end_onboarding_success",
      "type": "success",
      "description": "User onboarding completed"
    },
    {
      "id": "end_emergency",
      "type": "escalation",
      "description": "Emergency situation handled"
    },
    {
      "id": "end_error",
      "type": "error",
      "description": "Error handled gracefully"
    }
  ],
  "variables": [
    {
      "name": "daily_questions_count",
      "type": "integer",
      "default": 0,
      "description": "Number of questions asked today"
    },
    {
      "name": "profile_complete",
      "type": "boolean",
      "default": false,
      "description": "Whether user has complete profile"
    },
    {
      "name": "original_question",
      "type": "string",
      "description": "User's original technical question"
    },
    {
      "name": "contact_name",
      "type": "string",
      "description": "User's full name"
    },
    {
      "name": "maritime_rank",
      "type": "string",
      "description": "User's maritime rank/position"
    },
    {
      "name": "ship_company",
      "type": "string",
      "description": "User's current ship or company"
    }
  ],
  "integrations": {
    "webhook_url": "https://your-domain.replit.app/api/wati/webhook",
    "ai_service": {
      "provider": "openai",
      "model": "o1-mini",
      "api_key": "{{OPENAI_API_KEY}}"
    },
    "database": {
      "conversation_state": true,
      "message_history": true,
      "user_profiles": true
    }
  }
}